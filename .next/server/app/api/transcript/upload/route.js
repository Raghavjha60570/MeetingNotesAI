"use strict";(()=>{var e={};e.id=850,e.ids=[850],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},2623:e=>{e.exports=require("worker_threads")},1568:e=>{e.exports=require("zlib")},7561:e=>{e.exports=require("node:fs")},4492:e=>{e.exports=require("node:stream")},2477:e=>{e.exports=require("node:stream/web")},2855:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>c});var o=r(9303),a=r(8716),n=r(670),i=r(5456),p=r(7070);let u=new(r(4214)).ZP({apiKey:process.env.OPENAI_API_KEY});async function c(e){try{let t=(0,i.fU)(),{data:{user:r}}=await t.auth.getUser();if(!r)return p.NextResponse.json({error:"Unauthorized"},{status:401});let s=await e.formData(),o=s.get("meeting_id"),a=s.get("audio_url");if(!o||!a)return p.NextResponse.json({error:"Meeting ID and audio URL are required"},{status:400});let{data:n,error:c}=await t.from("meetings").select("*").eq("id",o).eq("user_id",r.id).single();if(c||!n)return p.NextResponse.json({error:"Meeting not found"},{status:404});let l=await fetch(a);if(!l.ok)throw Error("Failed to download audio file");let m=await l.arrayBuffer(),g=new File([m],"audio.mp3",{type:"audio/mpeg"});try{let e=await u.audio.transcriptions.create({file:g,model:"whisper-1",response_format:"verbose_json",timestamp_granularities:["segment"]});if(e.segments){let r=e.segments.map(e=>({meeting_id:o,text:e.text,start_time:d(e.start),end_time:d(e.end),confidence:e.confidence||null,status:"completed"})),{error:s}=await t.from("transcript_chunks").insert(r);if(s)throw console.error("Error saving transcript chunks:",s),Error("Failed to save transcription")}await t.from("meetings").update({status:"completed",end_time:new Date().toISOString()}).eq("id",o);try{await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/meetings/generate-summary`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({meeting_id:o})})}catch(e){console.error("Error triggering summary generation:",e)}return p.NextResponse.json({success:!0,transcript_segments:e.segments?.length||0,full_transcript:e.text})}catch(e){throw console.error("Transcription error:",e),await t.from("meetings").update({status:"cancelled"}).eq("id",o),Error("Failed to transcribe audio: "+e.message)}}catch(e){return console.error("Unexpected error:",e),p.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}function d(e){return`${Math.floor(e/3600).toString().padStart(2,"0")}:${Math.floor(e%3600/60).toString().padStart(2,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`}let l=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/transcript/upload/route",pathname:"/api/transcript/upload",filename:"route",bundlePath:"app/api/transcript/upload/route"},resolvedPagePath:"/Users/ankursingh/Test-cursor/live-meeting-notes/src/app/api/transcript/upload/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:x}=l,f="/api/transcript/upload/route";function h(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},5456:(e,t,r)=>{r.d(t,{fU:()=>a});var s=r(7122),o=r(1615);let a=()=>{let e=(0,o.cookies)();return(0,s.lx)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,554,706,972,214],()=>r(2855));module.exports=s})();